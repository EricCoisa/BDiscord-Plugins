/**
 * @name CallGameFocus
 * @version 1.2
 * @author Coisa
 * @authorLink https://github.com/EricCoisa
 * @description Decrease audio from players who are not in the same game
 * @website https://github.com/EricCoisa/BDiscord-Plugins
 * @source https://github.com/EricCoisa/BDiscord-Plugins/CallGameFocus/build/CallGameFocus.plugin.js
 * 
 */

const VolumeMin = 5;
const VolumeMax = 90;
const ForceVolume = {};

const find=(filter,{resolve:resolve=!0,entries:entries=!1}={})=>BdApi.Webpack.getModule(filter,{defaultExport:resolve,searchExports:entries}),negocio=(...keys)=>target=>target instanceof Object&&keys.every(key=>key in target),byKeys=(keys,options)=>find(negocio(...keys),options),MediaEngineActions=byKeys(["setLocalVolume"]);module.exports=class CPlus{constructor(meta){this.ListOnCall=[],this.ListOffCall=[],this.observer,this.botao,this.mutado=!1}start(){setTimeout(()=>{this.RemoverBtnExtra()},100),setTimeout(()=>{this.botao=document.createElement("button"),this.botao.textContent="M",this.botao.addEventListener("click",()=>{this.AutoMude()}),this.botao.classList.add("botaoCPlug","button-12Fmur","enabled-9OeuTA","button-ejjZWC","lookBlank-FgPMy6","colorBrand-2M3O3N","grow-2T4nbg","button-12Fmur");const root=document.getElementById("app-mount");root.append(this.botao),this.Ocultar(this.botao),this.AddOnCall(()=>{const areaUsuario=document.querySelector(".container-1zzFcN >div.flex-2S1XBF >div.flex-2S1XBF");areaUsuario.prepend(this.botao),this.Mostrar(this.botao),BdApi.onRemoved(this.botao,()=>{areaUsuario.prepend(this.botao)})}),this.AddOffCall(()=>{root.append(this.botao),this.Ocultar(this.botao)}),this.CPlusInit(),this.VerificarOnCallAoIniciar()},100)}stop(){this.ListOnCall.splice(0,this.ListOnCall.length),this.ListOffCall.splice(0,this.ListOffCall.length),this.botao.remove(),this.RemoverBtnExtra()}RemoverBtnExtra(){const elements=document.querySelectorAll("button.botaoCPlug");elements.forEach(element=>{const root=document.getElementById("app-mount");root.append(element),element.remove()})}VerificarOnCallAoIniciar(){var painelCall;return null!=document.querySelector("div.container-1zzFcN")&&this.OnCall(),!1}AutoMude(){0!=this.VerificarDiscord()&&(0==this.mutado?this.Mute():this.Desmute())}Mute(){1==this.MutarOutrosJogadores()&&(this.botao.style.backgroundColor="var(--yellow-400)",this.botao.style.color="var(--white-500)",this.mutado=!0)}Desmute(){this.botao.style.backgroundColor="",this.botao.style.color="",this.DesMutarOutrosJogadores(),this.mutado=!1}DesMutarOutrosJogadores(){var ListaJogadoresEmCall;this.GetPlayerGames().forEach(player=>{if(0==player[3]){var volume=90,forcarVolume=ForceVolume[player[1]];null!=forcarVolume&&(volume=forcarVolume),MediaEngineActions.setLocalVolume(player[0],volume,null)}})}MutarOutrosJogadores(){var idUsuario=this.GetIDProprio(),jogoAtual=this.GetUserJogo2(),ListaJogadoresEmCall;return null==jogoAtual?(this.Erro("Jogo nÃ£o foi iniciado"),!1):(this.GetPlayerGames().forEach(player=>{if(player[0]==idUsuario||1==player[3])return!1;player[2]!=jogoAtual&&MediaEngineActions.setLocalVolume(player[0],5,null)}),!0)}GetUserJogo2(){var painelJogo=document.querySelector("div.panel-2ZFCRb");if(null==painelJogo)return null;var texto=painelJogo.querySelector("div.title-338goq"),jogo;return null==texto?null:texto.textContent}GetUserJogo(idUsuario){var ElementoLista,avatar=document.querySelector("div.members-3WRCEx").querySelector("img[src*='"+idUsuario+"']");if(null==avatar)return 0;var playerElemento=avatar.closest(".memberInner--L4X2b");if(null==playerElemento)return 0;var jogandoElement=playerElemento.querySelector(".textRuler-1DsANg > strong"),jogo=0;return null==jogandoElement&&null==jogandoElement||(jogo=jogandoElement.textContent),jogo}GetPlayerGames(){var ListaPlayers=this.GetListaPlayers(),ListaPlayersResult=new Array;return ListaPlayers.forEach(player=>{ListaPlayersResult.push([player[0],player[1],this.GetUserJogo(player[0]),player[2]])}),ListaPlayersResult}VerificarDiscord(){var painelDireita=document.querySelector("div.container-2o3qEW"),painelEsquerda=document.querySelector("div.sidebar-1tnWFu");return null!=painelDireita&&null!=painelEsquerda||(null==painelDireita&&this.Erro("Abra o painel de Amigos no Servidor"),!1)}GetListaPlayers(){var idUsuario=this.GetIDProprio(),Canal,UsuariosElemento=this.GetElementoCanal(idUsuario).querySelectorAll("div[style].userAvatar-3Hwf1F"),ListaUsuarios=new Array;return UsuariosElemento.forEach(elemento=>{var id=this.GetIdUrl(elemento.getAttribute("style")),nome=elemento.parentElement.querySelector("div ~ div.usernameFont-2oJxoI").textContent,mutado=null!=elemento.parentElement.querySelector("svg.icon-N9JZb6:not(.iconServer-GeSR0b)");ListaUsuarios.push([id,nome,mutado])}),ListaUsuarios}GetElementoCanal(idUsuario){var ListaCanaisElemento,avatar=document.querySelector("ul.content-yjf30S").querySelector("div[style*='"+idUsuario+"']");return null==avatar&&this.Erro("Deixe o servidor em Call aberto durante o uso"),avatar.closest(".containerDefault-YUSmu3")}Erro(msg){BdApi.showToast(msg,{type:"error"})}GetIDProprio(){var elemento=document.querySelector(".avatarStack-3Bjmsl >img");return this.GetIdAvatar(elemento)}GetIdUrl(url){var padrao;return/\/avatars\/([^/]+)\//.exec(url)[1]}GetIdAvatar(ElementoAvatar){var conteudo=ElementoAvatar.src;return this.GetIdUrl(conteudo)}AddOnCall(func){this.ListOnCall.push((function(){func()}))}AddOffCall(func){this.ListOffCall.push((function(){func()}))}Mostrar(elemento){elemento.style.display="block"}Ocultar(elemento){elemento.style.display="none"}CPlusInit(){var OnCallElement=document.querySelector(".wrapper-3Hk9OB");this.observer=new MutationObserver(()=>{this.OnCall(OnCallElement)}),this.observer.observe(OnCallElement,{attributes:!0,childList:!0,characterData:!0}),document.addEventListener("keydown",e=>{"q"===e.key.toLowerCase()&&e.altKey&&this.AutoMude()})}OnCall(){var OnCallElement;if(document.querySelector(".wrapper-3Hk9OB").childElementCount>0)for(let index=0;index<this.ListOnCall.length;index++)this.ListOnCall[index]();else for(let index=0;index<this.ListOffCall.length;index++)this.ListOffCall[index]()}};